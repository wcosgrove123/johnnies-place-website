<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog - Johnnie's Place</title>
  <meta name="description" content="Updates, stories, and news from Johnnie's Place.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/jpeg" href="images/tab-logo.jpg">
  <link rel="apple-touch-icon" href="images/tab-logo.jpg">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>

  <!-- NAVIGATION -->
  <nav class="nav" id="nav">
    <div class="nav-inner">
      <a href="index.html" class="nav-logo">
        <img src="images/logo.png" alt="Johnnie's Place" class="logo-img">
      </a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li class="nav-dropdown">
          <a href="about.html">About</a>
          <div class="dropdown-menu">
            <a href="about.html">Our Story</a>
            <a href="mission.html">Mission</a>
            <a href="team.html">Leadership Team</a>
          </div>
        </li>
        <li class="nav-dropdown">
          <a href="blog.html" class="active">Updates</a>
          <div class="dropdown-menu">
            <a href="stay-updated.html">Stay Updated</a>
            <a href="blog.html">Blog</a>
            <a href="news.html">News</a>
          </div>
        </li>
        <li><a href="events.html">Events</a></li>
        <li class="nav-dropdown">
          <a href="support.html">Support Us</a>
          <div class="dropdown-menu">
            <a href="support.html#donate">Donate</a>
            <a href="fundraisers.html">Fundraisers</a>
            <a href="get-involved.html">Get Involved</a>
          </div>
        </li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <div class="nav-actions">
        <a href="support.html" class="btn btn-primary">Donate</a>
      </div>
      <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
        <span></span><span></span><span></span>
      </button>
    </div>
    <div class="mobile-nav" id="mobileNav">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="mission.html">Mission</a>
      <a href="team.html">Leadership</a>
      <a href="stay-updated.html">Stay Updated</a>
      <a href="blog.html">Blog</a>
      <a href="news.html">News</a>
      <a href="events.html">Events</a>
      <a href="support.html">Donate</a>
      <a href="fundraisers.html">Fundraisers</a>
      <a href="get-involved.html">Get Involved</a>
      <a href="contact.html">Contact</a>
    </div>
  </nav>

  <!-- PAGE HEADER -->
  <section class="page-header">
    <div class="section-inner">
      <h1>Blog & Updates</h1>
      <p class="page-subtitle">Stories, news, and updates from Johnnie's Place</p>
    </div>
  </section>

  <!-- BLOG POSTS -->
  <section class="section">
    <div class="section-inner">
      <div class="blog-grid" id="blog-posts-container">
        <div class="blog-empty-state">
          <p>Loading blog posts...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- NEWSLETTER SIGNUP -->
  <section class="section newsletter-section">
    <div class="section-inner">
      <div class="newsletter-content">
        <h2>Stay Updated</h2>
        <p>Subscribe to receive news, updates, and stories from Johnnie's Place directly to your inbox.</p>
        <form class="newsletter-form" id="newsletterForm">
          <input type="email" placeholder="Your email address" required>
          <button type="submit" class="btn btn-primary">Subscribe</button>
        </form>
        <p class="newsletter-note">We respect your privacy and won't share your information.</p>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-top">
        <div class="footer-brand">
          <img src="images/logo.png" alt="Johnnie's Place" class="footer-logo">
          <p>Building community and providing safe housing for adults with autism.</p>
        </div>
        <div class="footer-col">
          <h4>Organization</h4>
          <a href="index.html">Home</a>
          <a href="about.html">About</a>
          <a href="mission.html">Mission</a>
        </div>
        <div class="footer-col">
          <h4>Get Involved</h4>
          <a href="support.html">Donate</a>
          <a href="blog.html">Blog</a>
          <a href="contact.html">Contact</a>
        </div>
        <div class="footer-col">
          <h4>Contact</h4>
          <p>318 East Elm Street<br>Conshohocken, PA 19428</p>
          <p>610 960 8205</p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Johnnie's Place. All rights reserved. • <a href="/admin/" style="color: var(--text-muted); text-decoration: underline;">Admin Login</a></p>
        <p class="footer-legal">501(c)(3) Tax-Exempt Organization</p>
      </div>
    </div>
  </footer>

  <script src="js/main.js"></script>
  <script>
    // Newsletter form handling
    const newsletterForm = document.getElementById('newsletterForm');
    if (newsletterForm) {
      newsletterForm.addEventListener('submit', (e) => {
        e.preventDefault();
        alert('Thank you for subscribing! Newsletter functionality will be integrated soon.');
        newsletterForm.reset();
      });
    }

    // Load blog posts dynamically
    async function loadBlogPosts() {
      const container = document.getElementById('blog-posts-container');

      // List of blog post files (in production, this would come from an API or build process)
      // For now, we'll try to load known posts
      const blogPosts = [
        '2025-02-11-welcome'
      ];

      if (blogPosts.length === 0) {
        container.innerHTML = '<div class="blog-empty-state"><p>More blog posts coming soon. Check back regularly for updates!</p></div>';
        return;
      }

      try {
        const posts = await Promise.all(
          blogPosts.map(async (slug) => {
            try {
              const response = await fetch(`content/blog/${slug}.md`);
              if (!response.ok) throw new Error('Post not found');
              const text = await response.text();

              // Parse frontmatter
              const frontmatterRegex = /^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/;
              const match = text.match(frontmatterRegex);

              if (match) {
                const frontmatter = match[1];
                const meta = {};
                frontmatter.split('\n').forEach(line => {
                  const [key, ...valueParts] = line.split(':');
                  if (key && valueParts.length > 0) {
                    meta[key.trim()] = valueParts.join(':').trim().replace(/^["']|["']$/g, '');
                  }
                });

                return {
                  slug,
                  title: meta.title || 'Untitled',
                  date: meta.date ? new Date(meta.date) : new Date(),
                  author: meta.author || 'Unknown',
                  excerpt: meta.excerpt || ''
                };
              }
            } catch (error) {
              console.error(`Error loading post ${slug}:`, error);
              return null;
            }
          })
        );

        // Filter out failed posts and sort by date
        const validPosts = posts.filter(p => p !== null).sort((a, b) => b.date - a.date);

        if (validPosts.length === 0) {
          container.innerHTML = '<div class="blog-empty-state"><p>More blog posts coming soon. Check back regularly for updates!</p></div>';
          return;
        }

        // Render posts
        container.innerHTML = validPosts.map(post => {
          const dateStr = post.date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
          return `
            <article class="blog-post-card">
              <div class="blog-post-meta">
                <span class="blog-date">${dateStr}</span>
                <span class="blog-author">by ${post.author}</span>
              </div>
              <h2 class="blog-post-title">${post.title}</h2>
              <p class="blog-post-excerpt">${post.excerpt}</p>
              <a href="blog-post.html?post=${post.slug}" class="blog-read-more">Read More →</a>
            </article>
          `;
        }).join('') + '<div class="blog-empty-state"><p>More blog posts coming soon. Check back regularly for updates!</p></div>';

      } catch (error) {
        console.error('Error loading blog posts:', error);
        container.innerHTML = '<div class="blog-empty-state"><p>Unable to load blog posts. Please try again later.</p></div>';
      }
    }

    // Load posts when page loads
    loadBlogPosts();
  </script>
  <script>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>
</body>
</html>
